<!-- Floating Chat Widget -->
<div id="chat-widget" class="chat-widget" style="display: none;">
  <!-- Minimized State -->
  <button id="chat-widget-toggle" class="chat-widget-toggle" title="Open Chat">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="chat-icon">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
    </svg>
    <span class="chat-unread-badge" id="chat-unread-badge" style="display: none;">0</span>
  </button>

  <!-- Expanded Chat Window -->
  <div id="chat-widget-window" class="chat-widget-window" style="display: none;">
    <!-- Chat Header -->
    <div class="chat-widget-header">
      <div class="chat-header-info">
        <div class="chat-church-avatar" id="chat-church-avatar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
        </div>
        <div class="chat-header-text">
          <h3 class="chat-church-name" id="chat-church-name">Select a conversation</h3>
          <span class="chat-status" id="chat-status">Offline</span>
        </div>
      </div>
      <div class="chat-header-actions">
        <button class="chat-action-btn" id="chat-minimize-btn" title="Minimize">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
        </button>
        <button class="chat-action-btn" id="chat-close-btn" title="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Chat Conversations List (when no active chat) -->
    <div id="chat-conversations-list" class="chat-conversations-list">
      <div class="chat-conversations-header">
        <h4>Messages</h4>
        <button class="btn-text-small" id="new-conversation-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          New
        </button>
      </div>
      <div class="chat-conversations-scroll" id="chat-conversations-scroll">
        <!-- Conversations will be loaded here -->
        <div class="chat-empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          <p>No conversations yet</p>
          <p class="text-muted">Start a conversation with a church</p>
        </div>
      </div>
    </div>

    <!-- Active Chat View -->
    <div id="chat-active-view" class="chat-active-view" style="display: none;">
      <!-- Back to conversations button -->
      <button class="chat-back-btn" id="chat-back-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"/>
          <polyline points="12 19 5 12 12 5"/>
        </svg>
        Back
      </button>

      <!-- Chat Messages Container -->
      <div class="chat-messages" id="chat-messages">
        <!-- Messages will be loaded here -->
      </div>

      <!-- Chat Input -->
      <div class="chat-input-container">
        <!-- File Preview -->
        <div id="chat-file-preview" class="chat-file-preview" style="display: none;">
          <div class="chat-file-preview-content">
            <img id="chat-file-preview-image" style="display: none; max-width: 100%; max-height: 100px; border-radius: 8px;">
            <div id="chat-file-preview-doc" class="chat-file-preview-doc" style="display: none;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                <polyline points="13 2 13 9 20 9"/>
              </svg>
              <span id="chat-file-preview-name"></span>
            </div>
            <button type="button" class="chat-file-remove-btn" id="chat-file-remove-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </div>
        
        <form id="chat-message-form" class="chat-message-form">
          <input type="file" id="chat-file-input" accept="image/*,.pdf,.doc,.docx,.txt" style="display: none;">
          <button type="button" class="chat-attach-btn" id="chat-attach-btn" title="Attach file">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
            </svg>
          </button>
          <textarea
            id="chat-message-input"
            class="chat-message-input"
            placeholder="Type a message..."
            rows="1"
            maxlength="1000"></textarea>
          <button type="submit" class="chat-send-btn" id="chat-send-btn" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </form>
        <div class="chat-typing-indicator" id="chat-typing-indicator" style="display: none;">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div id="chat-loading" class="chat-loading" style="display: none;">
      <div class="chat-loading-spinner"></div>
      <p>Loading messages...</p>
    </div>
  </div>
</div>
