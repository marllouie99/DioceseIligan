{% load static %}
{# Parish Admins Tab Content #}
<div class="tab-panel" id="admins">
  <div class="tab-header">
    <h2>Parish Admins</h2>
    <p>Manage administrators and staff for your parish</p>
  </div>
  <div class="tab-content">
    
    {# Admin Information Card #}
    <div class="admin-info-section">
      <div class="info-card">
        <div class="info-card-header">
          <div class="info-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 16v-4M12 8h.01"/>
            </svg>
          </div>
          <div>
            <h3>Parish Administration Team</h3>
            <p>Manage your parish team with different roles and permissions</p>
          </div>
        </div>
      </div>
    </div>

    {# Parish Manager Section #}
    <div class="admin-section">
      <div class="section-header-with-action">
        <div class="section-header-left">
          <div class="role-badge role-manager">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span>Parish Manager</span>
          </div>
          <p class="role-description">Full administrative access to all parish features</p>
        </div>
      </div>

      {% if church.owner %}
        <div class="admin-table-wrapper">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div class="admin-user-cell">
                    <div class="admin-avatar">
                      {% if church.owner.profile and church.owner.profile.profile_image %}
                        <img src="{{ church.owner.profile.profile_image.url }}" alt="{{ church.owner.get_full_name|default:church.owner.username }}">
                      {% else %}
                        <div class="avatar-placeholder">
                          {{ church.owner.get_full_name|default:church.owner.username|slice:":1"|upper }}
                        </div>
                      {% endif %}
                    </div>
                    <div class="admin-user-info">
                      <span class="admin-name">{{ church.owner.get_full_name|default:church.owner.username }}</span>
                      <span class="admin-role-label">Primary Manager</span>
                    </div>
                  </div>
                </td>
                <td>{{ church.owner.email }}</td>
                <td>{% if church.owner.profile %}{{ church.owner.profile.phone|default:"Not provided" }}{% else %}Not provided{% endif %}</td>
                <td>
                  <span class="status-badge status-active">Active</span>
                </td>
                <td>
                  <a href="{% url 'manage_profile' %}" class="btn-table-action">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                    View Profile
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="empty-state-small">
          <p>No Parish Manager assigned</p>
        </div>
      {% endif %}
    </div>

    {# Parish Secretary/Coordinator Section #}
    <div class="admin-section">
      <div class="section-header-with-action">
        <div class="section-header-left">
          <div class="role-badge role-secretary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span>Parish Secretary/Coordinator</span>
          </div>
          <p class="role-description">Manage bookings, events, and day-to-day operations</p>
        </div>
        <button class="btn-add-member" onclick="openAddStaffModal('secretary')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Add Secretary
        </button>
      </div>

      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if secretaries %}
              {% for staff in secretaries %}
              <tr>
                <td>
                  <div class="admin-user-cell">
                    <div class="admin-avatar">
                      {% if staff.user.profile and staff.user.profile.profile_image %}
                        <img src="{{ staff.user.profile.profile_image.url }}" alt="{{ staff.user.get_full_name|default:staff.user.username }}">
                      {% else %}
                        <div class="avatar-placeholder">
                          {{ staff.user.get_full_name|default:staff.user.username|slice:":1"|upper }}
                        </div>
                      {% endif %}
                    </div>
                    <div class="admin-user-info">
                      <span class="admin-name">{{ staff.user.get_full_name|default:staff.user.username }}</span>
                      <span class="admin-role-label">Secretary</span>
                    </div>
                  </div>
                </td>
                <td>{{ staff.user.email }}</td>
                <td>{% if staff.user.profile %}{{ staff.user.profile.phone|default:"Not provided" }}{% else %}Not provided{% endif %}</td>
                <td>
                  <span class="status-badge status-{{ staff.status }}">{{ staff.get_status_display }}</span>
                </td>
                <td>
                  <button class="btn-table-action" onclick="openStaffModal({{ staff.id }}, '{{ staff.user.get_full_name|default:staff.user.username|escapejs }}', '{{ staff.user.email }}', '{% if staff.user.profile %}{{ staff.user.profile.phone|default:"Not provided" }}{% else %}Not provided{% endif %}', 'Secretary', '{{ staff.get_status_display }}', '{% if staff.user.profile and staff.user.profile.profile_image %}{{ staff.user.profile.profile_image.url }}{% endif %}')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                    View Details
                  </button>
                </td>
              </tr>
              {% endfor %}
            {% else %}
            <tr>
              <td colspan="5" class="empty-cell">
                <div class="empty-state-small">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                  <p>No Parish Secretaries added yet</p>
                  <small>Click "Add Secretary" to invite team members</small>
                </div>
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    {# Ministry Leader/Volunteer Section #}
    <div class="admin-section">
      <div class="section-header-with-action">
        <div class="section-header-left">
          <div class="role-badge role-volunteer">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
            </svg>
            <span>Ministry Leader/Volunteer</span>
          </div>
          <p class="role-description">Create content, manage events, and engage with community</p>
        </div>
        <button class="btn-add-member" onclick="openAddStaffModal('volunteer')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Add Leader
        </button>
      </div>

      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if volunteers %}
              {% for staff in volunteers %}
              <tr>
                <td>
                  <div class="admin-user-cell">
                    <div class="admin-avatar">
                      {% if staff.user.profile and staff.user.profile.profile_image %}
                        <img src="{{ staff.user.profile.profile_image.url }}" alt="{{ staff.user.get_full_name|default:staff.user.username }}">
                      {% else %}
                        <div class="avatar-placeholder">
                          {{ staff.user.get_full_name|default:staff.user.username|slice:":1"|upper }}
                        </div>
                      {% endif %}
                    </div>
                    <div class="admin-user-info">
                      <span class="admin-name">{{ staff.user.get_full_name|default:staff.user.username }}</span>
                      <span class="admin-role-label">Volunteer</span>
                    </div>
                  </div>
                </td>
                <td>{{ staff.user.email }}</td>
                <td>{% if staff.user.profile %}{{ staff.user.profile.phone|default:"Not provided" }}{% else %}Not provided{% endif %}</td>
                <td>
                  <span class="status-badge status-{{ staff.status }}">{{ staff.get_status_display }}</span>
                </td>
                <td>
                  <button class="btn-table-action" onclick="openStaffModal({{ staff.id }}, '{{ staff.user.get_full_name|default:staff.user.username|escapejs }}', '{{ staff.user.email }}', '{% if staff.user.profile %}{{ staff.user.profile.phone|default:"Not provided" }}{% else %}Not provided{% endif %}', 'Ministry Leader', '{{ staff.get_status_display }}', '{% if staff.user.profile and staff.user.profile.profile_image %}{{ staff.user.profile.profile_image.url }}{% endif %}')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                    View Details
                  </button>
                </td>
              </tr>
              {% endfor %}
            {% else %}
            <tr>
              <td colspan="5" class="empty-cell">
                <div class="empty-state-small">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                  </svg>
                  <p>No Ministry Leaders added yet</p>
                  <small>Click "Add Leader" to invite volunteers</small>
                </div>
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

{# Add Staff Modal #}
<div id="addStaffModal" class="staff-modal" style="display: none;">
  <div class="staff-modal-overlay" onclick="closeAddStaffModal()"></div>
  <div class="staff-modal-content">
    <div class="staff-modal-header">
      <h3 id="modalTitle">Add Staff Member</h3>
      <button type="button" class="staff-modal-close" onclick="closeAddStaffModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="staff-modal-body">
      <div class="search-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
          <label for="addStaffSearch">Search Followers</label>
          <a href="#" onclick="closeAddStaffModal(); switchToTab('followers'); return false;" class="btn-see-followers-modal">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            See All Followers
          </a>
        </div>
        <div class="search-input-wrapper">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" id="addStaffSearch" placeholder="Search by name or email..." autocomplete="off">
        </div>
      </div>

      <div class="followers-list" id="followersList">
        <div class="loading-state">
          <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
          </svg>
          <p>Loading followers...</p>
        </div>
      </div>
    </div>
  </div>
</div>

{# Staff Details Modal #}
<div id="staffDetailsModal" class="staff-modal" style="display: none;">
  <div class="staff-modal-overlay" onclick="closeStaffModal()"></div>
  <div class="staff-modal-content" style="max-width: 500px;">
    <div class="staff-modal-header">
      <h3 id="staffModalTitle">Staff Details</h3>
      <button type="button" class="staff-modal-close" onclick="closeStaffModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="staff-modal-body">
      <div class="staff-profile-section">
        <div class="staff-profile-header">
          <div class="staff-profile-avatar" id="staffAvatar">
            <div class="follower-avatar-placeholder" id="staffAvatarPlaceholder">M</div>
          </div>
          <div class="staff-profile-info">
            <h4 id="staffName">Staff Member</h4>
            <span class="staff-role-badge" id="staffRole">Role</span>
          </div>
        </div>
        
        <div class="staff-details-grid">
          <div class="staff-detail-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            <div>
              <span class="staff-detail-label">Email</span>
              <span class="staff-detail-value" id="staffEmail">email@example.com</span>
            </div>
          </div>
          
          <div class="staff-detail-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            <div>
              <span class="staff-detail-label">Phone</span>
              <span class="staff-detail-value" id="staffPhone">Not provided</span>
            </div>
          </div>
          
          <div class="staff-detail-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <div>
              <span class="staff-detail-label">Status</span>
              <span class="status-badge" id="staffStatus">Active</span>
            </div>
          </div>
        </div>
      </div>
      
      {# Activity Timeline #}
      <div class="staff-activity-section">
        <div class="activity-header">
          <h5>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
            </svg>
            Recent Activity
          </h5>
          <span class="activity-count" id="activityCount">0 actions</span>
        </div>
        
        <div class="activity-timeline" id="activityTimeline">
          <div class="activity-loading">
            <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
            <p>Loading activities...</p>
          </div>
        </div>
      </div>
      
      <div class="staff-modal-actions">
        <button class="btn-staff-remove" id="removeStaffBtn" onclick="removeStaffFromModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          Remove from Parish Staff
        </button>
      </div>
    </div>
  </div>
</div>

<style>
/* Admin Info Section */
.admin-info-section {
  margin-bottom: 2rem;
}

.info-card {
  background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
  border-radius: 12px;
  padding: 1.5rem;
  color: white;
}

.info-card-header {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
}

.info-icon {
  width: 48px;
  height: 48px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.info-icon svg {
  width: 24px;
  height: 24px;
}

.info-card h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
  font-weight: 600;
}

.info-card p {
  margin: 0;
  opacity: 0.9;
  font-size: 0.875rem;
}

/* Admin Section */
.admin-section {
  margin-bottom: 2rem;
}

.section-header-with-action {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
  gap: 1rem;
}

.section-header-left {
  flex: 1;
}

.role-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 0.875rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.role-badge svg {
  width: 18px;
  height: 18px;
}

.role-badge.role-manager {
  background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
  color: white;
}

.role-badge.role-secretary {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white;
}

.role-badge.role-volunteer {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
}

.role-description {
  margin: 0;
  font-size: 0.875rem;
  color: var(--muted);
}

.btn-add-member {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 1.25rem;
  background: var(--brand);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-add-member:hover {
  background: var(--brand-dark, #1e40af);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

.btn-add-member svg {
  width: 16px;
  height: 16px;
}

/* Admin Table */
.admin-table-wrapper {
  background: white;
  border-radius: 12px;
  border: 1px solid var(--border);
  overflow: hidden;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
}

.admin-table thead {
  background: var(--bg-secondary, #f9fafb);
}

.admin-table th {
  padding: 0.875rem 1rem;
  text-align: left;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid var(--border);
}

/* Consistent column widths */
.admin-table th:nth-child(1),
.admin-table td:nth-child(1) { width: 30%; }
.admin-table th:nth-child(2),
.admin-table td:nth-child(2) { width: 25%; }
.admin-table th:nth-child(3),
.admin-table td:nth-child(3) { width: 15%; }
.admin-table th:nth-child(4),
.admin-table td:nth-child(4) { width: 12%; }
.admin-table th:nth-child(5),
.admin-table td:nth-child(5) { width: 18%; }

.admin-table td {
  padding: 1rem;
  border-bottom: 1px solid var(--border);
  font-size: 0.875rem;
  color: var(--text);
  vertical-align: middle;
}

.admin-table tbody tr:last-child td {
  border-bottom: none;
}

.admin-table tbody tr:hover {
  background: var(--bg-secondary, #f9fafb);
}

.admin-user-cell {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.admin-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
}

.admin-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.avatar-placeholder {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.125rem;
  font-weight: 700;
  color: white;
}

.admin-user-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.admin-name {
  font-weight: 600;
  color: var(--text);
}

.admin-role-label {
  font-size: 0.75rem;
  color: var(--muted);
}

.status-badge {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
}

.status-badge.status-active {
  background: #d1fae5;
  color: #065f46;
}

.status-badge.status-pending {
  background: #fef3c7;
  color: #92400e;
}

.status-badge.status-inactive {
  background: #fee2e2;
  color: #991b1b;
}

.btn-table-action {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem 0.875rem;
  background: white;
  color: var(--brand);
  border: 1px solid var(--brand);
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-table-action:hover {
  background: var(--brand);
  color: white;
}

.btn-table-action svg {
  width: 14px;
  height: 14px;
}

.empty-cell {
  padding: 0 !important;
  border: none !important;
}

.empty-state-small {
  text-align: center;
  padding: 3rem 2rem;
  color: var(--muted);
}

.empty-state-small svg {
  width: 48px;
  height: 48px;
  margin: 0 auto 1rem;
  opacity: 0.3;
  stroke: var(--muted);
}

.empty-state-small p {
  margin: 0 0 0.5rem 0;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text);
}

.empty-state-small small {
  font-size: 0.75rem;
  color: var(--muted);
}

.section-header {
  margin-bottom: 1.5rem;
}

.section-header h3 {
  margin: 0 0 0.25rem 0;
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text);
}

.section-header p {
  margin: 0;
  font-size: 0.875rem;
  color: var(--muted);
}

/* Future Feature Notice */
.future-feature-notice {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  border-radius: 12px;
  padding: 1.5rem;
  display: flex;
  gap: 1rem;
  color: white;
}

.notice-icon {
  width: 48px;
  height: 48px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.notice-icon svg {
  width: 24px;
  height: 24px;
}

.notice-content h4 {
  margin: 0 0 0.5rem 0;
  font-size: 1.125rem;
  font-weight: 600;
}

.notice-content p {
  margin: 0;
  opacity: 0.9;
  font-size: 0.875rem;
  line-height: 1.6;
}

/* See Followers Button in Modal */
.btn-see-followers-modal {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.375rem 0.75rem;
  background: white;
  color: var(--brand);
  border: 1px solid var(--brand);
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-see-followers-modal:hover {
  background: var(--brand);
  color: white;
}

.btn-see-followers-modal svg {
  width: 14px;
  height: 14px;
}

/* Staff Modal */
.staff-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.staff-modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
}

.staff-modal-content {
  position: relative;
  background: white;
  border-radius: 12px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  z-index: 10001;
}

.staff-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem;
  border-bottom: 1px solid var(--border);
}

.staff-modal-header h3 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text);
}

.staff-modal-close {
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  color: var(--muted);
  border-radius: 6px;
  transition: all 0.2s;
}

.staff-modal-close:hover {
  background: var(--bg-secondary);
  color: var(--text);
}

.staff-modal-close svg {
  width: 20px;
  height: 20px;
}

.staff-modal-body {
  padding: 1.5rem;
  overflow-y: auto;
  flex: 1;
}

.search-section {
  margin-bottom: 1.5rem;
}

.search-section label {
  display: block;
  margin-bottom: 0.5rem;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text);
}

.search-input-wrapper {
  position: relative;
}

.search-input-wrapper svg {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  color: var(--muted);
}

.search-input-wrapper input {
  width: 100%;
  padding: 0.75rem 1rem 0.75rem 3rem;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 0.875rem;
  transition: all 0.2s;
}

.search-input-wrapper input:focus {
  outline: none;
  border-color: var(--brand);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.followers-list {
  max-height: 400px;
  overflow-y: auto;
  min-height: 100px;
  background: #f9fafb;
  border-radius: 8px;
  padding: 0.5rem;
}

.loading-state {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--muted);
}

.spinner {
  width: 48px;
  height: 48px;
  margin: 0 auto 1rem;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.follower-item {
  display: flex !important;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  transition: all 0.2s;
  background: white;
  min-height: 60px;
}

.follower-item:hover {
  background: #f3f4f6;
  border-color: var(--brand);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.follower-info {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1;
}

.follower-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
}

.follower-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.follower-avatar-placeholder {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.125rem;
  font-weight: 700;
  color: white;
}

.follower-details {
  flex: 1;
}

.follower-name {
  font-weight: 600;
  color: var(--text);
  font-size: 0.875rem;
  display: block;
  margin-bottom: 0.25rem;
}

.follower-email {
  font-size: 0.75rem;
  color: var(--muted);
}

.btn-add-follower {
  padding: 0.5rem 1rem;
  background: var(--brand);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-add-follower:hover {
  background: var(--brand-dark, #1e40af);
}

.btn-add-follower:disabled {
  background: var(--muted);
  cursor: not-allowed;
  opacity: 0.5;
}

.empty-followers {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--muted);
}

.empty-followers svg {
  width: 48px;
  height: 48px;
  margin: 0 auto 1rem;
  opacity: 0.3;
}

.empty-followers p {
  margin: 0;
  font-size: 0.875rem;
}

/* Staff Details Modal Styles */
.staff-profile-section {
  padding-bottom: 1.5rem;
}

.staff-profile-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--border);
}

.staff-profile-avatar {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
}

.staff-profile-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.staff-profile-info {
  flex: 1;
}

.staff-profile-info h4 {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text);
}

.staff-role-badge {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white;
}

.staff-details-grid {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.staff-detail-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.75rem;
  background: var(--bg-secondary, #f9fafb);
  border-radius: 8px;
}

.staff-detail-item svg {
  width: 20px;
  height: 20px;
  color: var(--brand);
  flex-shrink: 0;
  margin-top: 2px;
}

.staff-detail-item > div {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.staff-detail-label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.staff-detail-value {
  font-size: 0.875rem;
  color: var(--text);
}

.staff-modal-actions {
  padding-top: 1.5rem;
  border-top: 1px solid var(--border);
}

.btn-staff-remove {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: white;
  color: #dc2626;
  border: 2px solid #dc2626;
  border-radius: 8px;
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-staff-remove:hover {
  background: #dc2626;
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
}

.btn-staff-remove svg {
  width: 18px;
  height: 18px;
}

/* Activity Timeline Styles */
.staff-activity-section {
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--border);
}

.activity-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.activity-header h5 {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.activity-header svg {
  width: 18px;
  height: 18px;
  color: var(--brand);
}

.activity-count {
  font-size: 0.75rem;
  color: var(--muted);
  background: var(--bg-secondary, #f9fafb);
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
}

.activity-timeline {
  max-height: 300px;
  overflow-y: auto;
}

.activity-loading {
  text-align: center;
  padding: 2rem;
  color: var(--muted);
}

.activity-loading .spinner {
  width: 32px;
  height: 32px;
  margin: 0 auto 0.75rem;
  animation: spin 1s linear infinite;
}

.activity-loading p {
  margin: 0;
  font-size: 0.875rem;
}

.activity-item {
  display: flex;
  gap: 0.75rem;
  padding: 0.75rem;
  border-left: 2px solid var(--border);
  margin-left: 0.5rem;
  position: relative;
}

.activity-item:hover {
  background: var(--bg-secondary, #f9fafb);
  border-radius: 0 8px 8px 0;
}

.activity-item:last-child {
  border-left-color: transparent;
}

.activity-dot {
  position: absolute;
  left: -6px;
  top: 1rem;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--brand);
  border: 2px solid white;
  box-shadow: 0 0 0 2px var(--bg-secondary, #f9fafb);
}

.activity-icon {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 0.75rem;
  font-weight: 600;
}

.activity-icon.create { background: #dcfce7; color: #166534; }
.activity-icon.update { background: #dbeafe; color: #1e40af; }
.activity-icon.delete { background: #fee2e2; color: #991b1b; }
.activity-icon.approve { background: #d1fae5; color: #065f46; }
.activity-icon.reject { background: #fef3c7; color: #92400e; }
.activity-icon.cancel { background: #f3f4f6; color: #4b5563; }

.activity-content {
  flex: 1;
}

.activity-action {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 0.25rem;
}

.activity-description {
  font-size: 0.8125rem;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.activity-meta {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.75rem;
  color: var(--muted);
}

.activity-meta svg {
  width: 12px;
  height: 12px;
}

.activity-empty {
  text-align: center;
  padding: 2rem;
  color: var(--muted);
}

.activity-empty svg {
  width: 48px;
  height: 48px;
  margin: 0 auto 1rem;
  opacity: 0.3;
}

.activity-empty p {
  margin: 0;
  font-size: 0.875rem;
}

/* Responsive Design */
@media (max-width: 768px) {
  .section-header-with-action {
    flex-direction: column;
    align-items: stretch;
  }

  .section-header-with-action > div {
    width: 100%;
  }

  .permissions-grid {
    grid-template-columns: 1fr;
  }

  .staff-modal-content {
    max-width: 95%;
  }
}
</style>

<script>
let currentRole = '';

// Switch to a different tab
function switchToTab(tabName) {
  // Find and click the tab button
  const tabBtn = document.querySelector(`[data-tab="${tabName}"]`);
  if (tabBtn) {
    tabBtn.click();
  }
}

// Open add staff modal
function openAddStaffModal(role) {
  currentRole = role;
  const modal = document.getElementById('addStaffModal');
  const modalTitle = document.getElementById('modalTitle');
  
  if (role === 'secretary') {
    modalTitle.textContent = 'Add Parish Secretary/Coordinator';
  } else {
    modalTitle.textContent = 'Add Ministry Leader/Volunteer';
  }
  
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
  
  // Load followers
  loadFollowers();
}

// Close add staff modal
function closeAddStaffModal() {
  const modal = document.getElementById('addStaffModal');
  modal.style.display = 'none';
  document.body.style.overflow = '';
  currentRole = '';
}

// Load followers from the church
async function loadFollowers() {
  const followersList = document.getElementById('followersList');
  const searchInput = document.getElementById('addStaffSearch');
  
  try {
    const response = await fetch(`/app/manage-church/${CURRENT_CHURCH_ID}/followers-list/`);
    const data = await response.json();
    
    if (data.success) {
      displayFollowers(data.followers);
      
      // Add search functionality
      searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        const filtered = data.followers.filter(f => 
          f.name.toLowerCase().includes(query) || 
          f.email.toLowerCase().includes(query)
        );
        displayFollowers(filtered);
      });
    } else {
      followersList.innerHTML = `
        <div class="empty-followers">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          <p>Failed to load followers</p>
          <small style="color: #ef4444;">${data.message || 'Unknown error'}</small>
        </div>
      `;
    }
  } catch (error) {
    followersList.innerHTML = `
      <div class="empty-followers">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <p>Error loading followers</p>
        <small style="color: #ef4444;">${error.message}</small>
      </div>
    `;
  }
}

// Display followers in the list
function displayFollowers(followers) {
  const followersList = document.getElementById('followersList');
  
  if (followers.length === 0) {
    followersList.innerHTML = `
      <div class="empty-followers">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <p>No followers found</p>
      </div>
    `;
    return;
  }
  
  const html = followers.map(follower => `
    <div class="follower-item">
      <div class="follower-info">
        <div class="follower-avatar">
          ${follower.avatar ? 
            `<img src="${follower.avatar}" alt="${follower.name}">` :
            `<div class="follower-avatar-placeholder">${follower.name.charAt(0).toUpperCase()}</div>`
          }
        </div>
        <div class="follower-details">
          <span class="follower-name">${follower.name}</span>
          <span class="follower-email">${follower.email}</span>
        </div>
      </div>
      <button class="btn-add-follower" onclick="addStaffMember(${follower.id})" ${follower.is_staff ? 'disabled' : ''}>
        ${follower.is_staff ? 'Already Added' : 'Add'}
      </button>
    </div>
  `).join('');
  
  followersList.innerHTML = html;
  followersList.style.display = 'block'; // Make sure it's visible!
}

// Add staff member
async function addStaffMember(userId) {
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Adding...';
  
  try {
    const response = await fetch(`/app/manage-church/${CURRENT_CHURCH_ID}/add-staff/`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
      },
      body: JSON.stringify({
        user_id: userId,
        role: currentRole
      })
    });
    
    const data = await response.json();
    
    if (data.success) {
      alert('Staff member added successfully!');
      closeAddStaffModal();
      location.reload(); // Reload to show the new staff member
    } else {
      alert(data.message || 'Failed to add staff member');
      btn.disabled = false;
      btn.textContent = 'Add';
    }
  } catch (error) {
    console.error('Error adding staff member:', error);
    alert('An error occurred while adding the staff member');
    btn.disabled = false;
    btn.textContent = 'Add';
  }
}

// Staff details modal variables
let currentStaffId = null;
let currentStaffName = '';
let currentStaffRole = '';

// Open staff details modal
function openStaffModal(staffId, name, email, phone, role, status, avatarUrl) {
  currentStaffId = staffId;
  currentStaffName = name;
  currentStaffRole = role;
  
  const modal = document.getElementById('staffDetailsModal');
  
  // Set modal title
  document.getElementById('staffModalTitle').textContent = `${role} Details`;
  
  // Set avatar
  const avatarContainer = document.getElementById('staffAvatar');
  if (avatarUrl && avatarUrl.trim() !== '') {
    avatarContainer.innerHTML = `<img src="${avatarUrl}" alt="${name}">`;
  } else {
    const initial = name.charAt(0).toUpperCase();
    avatarContainer.innerHTML = `<div class="follower-avatar-placeholder">${initial}</div>`;
  }
  
  // Set staff info
  document.getElementById('staffName').textContent = name;
  document.getElementById('staffRole').textContent = role;
  document.getElementById('staffEmail').textContent = email;
  document.getElementById('staffPhone').textContent = phone;
  
  // Set status badge
  const statusBadge = document.getElementById('staffStatus');
  statusBadge.textContent = status;
  statusBadge.className = 'status-badge status-' + status.toLowerCase();
  
  // Show modal
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
  
  // Load activities
  loadStaffActivities(staffId);
}

// Load staff activities
async function loadStaffActivities(staffId) {
  const timeline = document.getElementById('activityTimeline');
  const countBadge = document.getElementById('activityCount');
  
  try {
    const response = await fetch(`/app/manage-church/${CURRENT_CHURCH_ID}/staff-activities/${staffId}/`);
    const data = await response.json();
    
    if (data.success) {
      const activities = data.activities;
      countBadge.textContent = `${data.total_count} action${data.total_count !== 1 ? 's' : ''}`;
      
      if (activities.length === 0) {
        timeline.innerHTML = `
          <div class="activity-empty">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
            </svg>
            <p>No activities recorded yet</p>
          </div>
        `;
      } else {
        timeline.innerHTML = activities.map(activity => {
          const actionClass = activity.action.toLowerCase();
          const icon = getActionIcon(actionClass);
          
          return `
            <div class="activity-item">
              <div class="activity-dot"></div>
              <div class="activity-icon ${actionClass}">
                ${icon}
              </div>
              <div class="activity-content">
                <div class="activity-action">${activity.action} ${activity.category}</div>
                <div class="activity-description">${activity.description}</div>
                <div class="activity-meta">
                  <span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    ${activity.created_at}
                  </span>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
    } else {
      timeline.innerHTML = `
        <div class="activity-empty">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          <p>${data.message || 'Failed to load activities'}</p>
        </div>
      `;
    }
  } catch (error) {
    console.error('Error loading activities:', error);
    timeline.innerHTML = `
      <div class="activity-empty">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <p>Error loading activities</p>
      </div>
    `;
  }
}

// Get action icon based on action type
function getActionIcon(action) {
  const icons = {
    'created': '+',
    'updated': '‚úì',
    'deleted': '√ó',
    'approved': '‚úì',
    'rejected': '√ó',
    'canceled': '‚Äì',
    'viewed': 'üëÅ'
  };
  return icons[action] || '‚Ä¢';
}

// Close staff details modal
function closeStaffModal() {
  const modal = document.getElementById('staffDetailsModal');
  modal.style.display = 'none';
  document.body.style.overflow = '';
  currentStaffId = null;
  currentStaffName = '';
  currentStaffRole = '';
}

// Remove staff from modal
async function removeStaffFromModal() {
  if (!confirm(`Are you sure you want to remove ${currentStaffName} as ${currentStaffRole}?\n\nThis will revoke their administrative access to this parish.`)) {
    return;
  }
  
  const btn = document.getElementById('removeStaffBtn');
  const originalContent = btn.innerHTML;
  btn.disabled = true;
  btn.innerHTML = '<svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px; animation: spin 1s linear infinite;"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Removing...';
  
  try {
    const response = await fetch(`/app/manage-church/${CURRENT_CHURCH_ID}/remove-staff/${currentStaffId}/`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
      }
    });
    
    const data = await response.json();
    
    if (data.success) {
      closeStaffModal();
      alert(`${currentStaffName} has been removed successfully!`);
      location.reload(); // Reload to update the table
    } else {
      alert(data.message || 'Failed to remove staff member');
      btn.disabled = false;
      btn.innerHTML = originalContent;
    }
  } catch (error) {
    console.error('Error removing staff member:', error);
    alert('An error occurred while removing the staff member');
    btn.disabled = false;
    btn.innerHTML = originalContent;
  }
}
</script>
