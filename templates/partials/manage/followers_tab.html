{% load static %}
{# Followers Tab Content #}
<div class="tab-panel" id="followers">
  <div class="tab-header">
    <h2>Followers</h2>
    <p>Manage and track your church's followers</p>
  </div>
  <div class="tab-content">
    
    {# 1x4 Grid Analytics Cards #}
    <div class="analytics-grid-4">
      <div class="analytics-card">
        <div class="analytics-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <div class="analytics-content">
          <h4>{{ follower_count|default:"0" }}</h4>
          <p>Total Followers</p>
          <span class="analytics-change positive">All time community</span>
        </div>
      </div>
      
      <div class="analytics-card">
        <div class="analytics-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <path d="M20 8v6M23 11h-6"/>
          </svg>
        </div>
        <div class="analytics-content">
          <h4>{{ followers_this_week|default:"0" }}</h4>
          <p>New This Week</p>
          <span class="analytics-change {% if growth_rate > 0 %}positive{% elif growth_rate < 0 %}negative{% else %}neutral{% endif %}">
            {% if growth_rate > 0 %}+{% endif %}{{ growth_rate|floatformat:1 }}% from last week
          </span>
        </div>
      </div>
      
      <div class="analytics-card">
        <div class="analytics-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
          </svg>
        </div>
        <div class="analytics-content">
          <h4>{{ active_followers|default:"0" }}</h4>
          <p>Active Followers</p>
          <span class="analytics-change {% if active_followers > 0 %}positive{% else %}neutral{% endif %}">
            {% if active_followers > 0 %}Engaging regularly{% else %}No recent activity{% endif %}
          </span>
        </div>
      </div>
      
      <div class="analytics-card">
        <div class="analytics-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
            <polyline points="17 6 23 6 23 12"/>
          </svg>
        </div>
        <div class="analytics-content">
          <h4>{% if growth_rate > 0 %}+{% endif %}{{ growth_rate|floatformat:1 }}%</h4>
          <p>Growth Rate</p>
          <span class="analytics-change {% if growth_rate > 0 %}positive{% elif growth_rate < 0 %}negative{% else %}neutral{% endif %}">
            Week over week comparison
          </span>
        </div>
      </div>
    </div>

    {# 1x2 Grid Charts Section #}
    <div class="charts-grid-2">
      {# Follower Growth Chart #}
      <div class="chart-container">
        <div class="chart-header">
          <h4>Follower Growth</h4>
          <p>Total and new followers over 6 months</p>
        </div>
        <div class="chart-content">
          <canvas id="followerGrowthChart" 
                  width="400" 
                  height="200"
                  data-total="{{ follower_count|default:'0' }}"
                  data-recent="{{ recent_followers|length|default:'0' }}"></canvas>
        </div>
      </div>

      {# Engagement Levels Chart #}
      <div class="chart-container">
        <div class="chart-header">
          <h4>Engagement Levels</h4>
          <p>Follower engagement distribution over time</p>
        </div>
        <div class="chart-content">
          <canvas id="engagementLevelsChart" 
                  width="400" 
                  height="200"></canvas>
        </div>
      </div>
    </div>

    {# 1x1 Grid Section - Your Followers Table #}
    <div class="followers-table-section">
      <div class="section-header">
        <div class="header-content">
          <h3>Your Followers</h3>
          <p>People following your church page</p>
        </div>
        <div class="header-actions">
          <div class="search-box">
            <i data-feather="search" class="search-icon"></i>
            <input 
              type="text" 
              id="followerSearch" 
              placeholder="Search followers..." 
              class="search-input"
              autocomplete="off"
            >
          </div>
          <button type="button" class="btn-export" onclick="exportFollowersList()">
            <i data-feather="download"></i>
            Export List
          </button>
        </div>
      </div>

      {% if recent_followers %}
        <div class="followers-table-wrapper">
          <table class="followers-table">
            <thead>
              <tr>
                <th>Follower</th>
                <th>Email</th>
                <th>Joined Date</th>
                <th>Post Interactions</th>
                <th>Engagement</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="followersTableBody">
              {% for follow in recent_followers %}
                <tr class="follower-row" 
                    data-name="{{ follow.user.get_full_name|default:follow.user.username|lower }}"
                    data-email="{{ follow.user.email|lower }}"
                    data-user-id="{{ follow.user.id }}">
                  <td>
                    <div class="follower-cell">
                      <div class="follower-avatar-small">
                        {% if follow.user.profile and follow.user.profile.profile_image %}
                          <img src="{{ follow.user.profile.profile_image.url }}" 
                               alt="{{ follow.user.get_full_name|default:follow.user.username }}" 
                               loading="lazy">
                        {% else %}
                          <div class="avatar-initials">
                            {{ follow.user.get_full_name|default:follow.user.username|first|upper }}
                          </div>
                        {% endif %}
                      </div>
                      <div class="follower-name-cell">
                        <span class="name">{{ follow.user.get_full_name|default:follow.user.username }}</span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <span class="email-text">{{ follow.user.email|default:"N/A" }}</span>
                  </td>
                  <td>
                    <span class="date-text">{{ follow.followed_at|date:"Y-m-d" }}</span>
                  </td>
                  <td>
                    <span class="interactions-count">{{ follow.user.interactions_count|default:0 }}</span>
                  </td>
                  <td>
                    <span class="engagement-badge engagement-{{ follow.user.engagement_level|default:'low' }}">
                      {{ follow.user.engagement_level|default:"Low"|title }}
                    </span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button type="button" 
                              class="btn-view-profile" 
                              onclick="viewFollowerProfile('{{ follow.user.id }}')"
                              title="View Profile">
                        View Profile
                      </button>
                      <div class="dropdown-wrapper">
                        <button type="button" 
                                class="btn-promote-dropdown" 
                                onclick="togglePromoteDropdown(event, {{ follow.user.id }})"
                                title="Promote to Admin">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="1"/>
                            <circle cx="12" cy="5" r="1"/>
                            <circle cx="12" cy="19" r="1"/>
                          </svg>
                        </button>
                        <div class="promote-dropdown" id="promoteDropdown{{ follow.user.id }}" style="display: none;">
                          <button type="button" 
                                  class="dropdown-item" 
                                  onclick="promoteFollower({{ follow.user.id }}, 'secretary')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                              <circle cx="9" cy="7" r="4"/>
                              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            Promote to Secretary
                          </button>
                          <button type="button" 
                                  class="dropdown-item" 
                                  onclick="promoteFollower({{ follow.user.id }}, 'volunteer')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                              <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            Promote to Ministry Leader
                          </button>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- No Results Message -->
        <div id="noFollowersResults" class="no-results" style="display: none;">
          <div class="empty-state">
            <i data-feather="search" class="empty-icon"></i>
            <h3>No followers found</h3>
            <p>Try adjusting your search criteria.</p>
          </div>
        </div>
      {% else %}
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          <h3>No Followers Yet</h3>
          <p>When people start following your church, they'll appear here. Share your church profile to get more followers!</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Follower Activity Modal -->
<div id="followerActivityModal" class="follower-modal">
  <div class="follower-modal-content">
    <div class="follower-modal-header">
      <h3 id="followerActivityTitle">Follower Activity</h3>
      <button class="follower-modal-close" onclick="closeFollowerActivity()">
        <i data-feather="x"></i>
      </button>
    </div>
    
    <div class="follower-modal-body">
      <div class="activity-tabs">
        <button class="activity-tab active" data-tab="interactions">Interactions</button>
        <button class="activity-tab" data-tab="appointments">Appointments</button>
        <button class="activity-tab" data-tab="reviews">Reviews</button>
        <button class="activity-tab" data-tab="timeline">Timeline</button>
      </div>
      
      <div class="activity-content">
        <div id="interactions-tab" class="activity-panel active">
          <div class="activity-loading">
            <i data-feather="loader" class="spinning"></i>
            <span>Loading interactions...</span>
          </div>
          <div class="activity-list" id="interactionsList" style="display: none;">
            <!-- Dynamic content will be loaded here -->
          </div>
        </div>
        
        <div id="appointments-tab" class="activity-panel">
          <div class="activity-loading">
            <i data-feather="loader" class="spinning"></i>
            <span>Loading appointments...</span>
          </div>
          <div class="activity-list" id="appointmentsList" style="display: none;">
            <!-- Dynamic content will be loaded here -->
          </div>
        </div>
        
        <div id="reviews-tab" class="activity-panel">
          <div class="activity-loading">
            <i data-feather="loader" class="spinning"></i>
            <span>Loading reviews...</span>
          </div>
          <div class="activity-list" id="reviewsList" style="display: none;">
            <!-- Dynamic content will be loaded here -->
          </div>
        </div>
        
        <div id="timeline-tab" class="activity-panel">
          <div class="activity-loading">
            <i data-feather="loader" class="spinning"></i>
            <span>Loading timeline...</span>
          </div>
          <div class="activity-list" id="timelineList" style="display: none;">
            <!-- Dynamic content will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
