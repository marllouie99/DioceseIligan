{% extends 'layouts/app_base.html' %}
{% load static media_extras %}

{% block title %}{{ church.name }} - Church Details â€¢ ChurchConnect{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/variables/warm-sacred-earth-vars.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'css/themes/warm-sacred-earth-theme.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'css/components/buttons.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'css/components/cards.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'css/pages/church_detail.css' %}?v={{ STATIC_VERSION }}">
<style>
  /* Tab Navigation */
  .tab-navigation {
    display: flex;
    gap: 0.5rem;
    background: rgba(255, 249, 230, 0.6);
    padding: 0.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    border: 1px solid rgba(139, 69, 19, 0.15);
    overflow-x: auto;
    flex-wrap: wrap;
  }

  .tab-btn {
    padding: 0.875rem 1.5rem;
    background: transparent;
    border: none;
    border-radius: 8px;
    color: #6b7280;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .tab-btn svg {
    width: 18px;
    height: 18px;
  }

  .tab-btn:hover {
    color: #8B4513;
    background: rgba(139, 69, 19, 0.08);
  }

  .tab-btn.active {
    color: white;
    background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
    box-shadow: 0 2px 8px rgba(139, 69, 19, 0.2);
  }

  /* Tab Content */
  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.25rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, #FFF9E6 0%, #FFF5D6 100%);
    border: 1px solid rgba(218, 165, 32, 0.2);
    border-radius: 12px;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(160, 82, 45, 0.15);
  }

  .stat-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 56px;
    border-radius: 12px;
    background: rgba(160, 82, 45, 0.1);
    color: rgba(160, 82, 45, 1);
    flex-shrink: 0;
  }

  .stat-icon svg {
    width: 28px;
    height: 28px;
  }

  .stat-content {
    flex: 1;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #111827;
    line-height: 1;
    margin-bottom: 0.375rem;
  }

  .stat-label {
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 600;
  }
</style>
{% endblock %}

{% block sidebar %}
  {% include 'partials/sidebar.html' %}
{% endblock %}

{% block topbar %}
  {% include 'partials/topbar.html' %}
{% endblock %}

{% block content %}
<div class="church-detail-page warm-sacred-earth page-container" style="max-width: 1600px; margin: 0 auto; padding: 2rem;">
  
  <!-- Back Button -->
  <div style="margin-bottom: 1.5rem;">
    <a href="{% url 'core:super_admin_verifications' %}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: rgba(255, 255, 255, 0.8); color: #654321; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
      Back to Church Directory
    </a>
  </div>

  <!-- Church Header -->
  <div style="background: linear-gradient(135deg, #F8F4E6 0%, #F4E6D0 100%); border: 2px solid rgba(139, 69, 19, 0.2); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);">
    <div style="display: flex; align-items: center; gap: 2rem; margin-bottom: 1.5rem;">
      <div style="width: 120px; height: 120px; border-radius: 16px; background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 700; border: 3px solid rgba(139, 69, 19, 0.3); box-shadow: 0 4px 12px rgba(139, 69, 19, 0.2); flex-shrink: 0; overflow: hidden;">
        {% if church.logo %}
        <img src="{{ church.logo|storage_url }}" alt="{{ church.name }}" style="width: 100%; height: 100%; object-fit: cover;">
        {% else %}
        {{ church.name.0|upper }}
        {% endif %}
      </div>
      <div style="flex: 1;">
        <h1 style="font-size: 2.5rem; font-weight: 800; color: #2D1810; margin: 0 0 1rem 0; font-family: Georgia, 'Times New Roman', serif;">{{ church.name }}</h1>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
          <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #FFF9E6 0%, #FFF5D6 100%); border: 1px solid rgba(218, 165, 32, 0.3); border-radius: 9999px; font-size: 0.875rem; color: #654321; font-weight: 600;">{{ church.get_denomination_display }}</span>
          <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #FFF9E6 0%, #FFF5D6 100%); border: 1px solid rgba(218, 165, 32, 0.3); border-radius: 9999px; font-size: 0.875rem; color: #654321; font-weight: 600;">{{ church.get_size_display }}</span>
          {% if church.is_verified %}
          <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%); color: #166534; border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 9999px; font-size: 0.875rem; font-weight: 700; text-transform: uppercase;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            Verified
          </span>
          {% else %}
          <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%); color: #92400e; border: 1px solid rgba(245, 158, 11, 0.2); border-radius: 9999px; font-size: 0.875rem; font-weight: 700; text-transform: uppercase;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="8" x2="12" y2="12"/>
              <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            Unverified
          </span>
          {% endif %}
        </div>
      </div>
    </div>
    
    <div style="display: flex; gap: 1rem; padding-top: 1.5rem; border-top: 2px solid rgba(139, 69, 19, 0.15);">
      <a href="{% url 'core:super_admin_edit_church' church.id %}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white; border: none; border-radius: 8px; font-size: 0.9375rem; font-weight: 600; text-decoration: none; cursor: pointer; transition: all 0.2s;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
        Edit Church
      </a>
      <a href="{% url 'core:church_detail' church.slug %}" target="_blank" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: white; color: #8B4513; border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px; font-size: 0.9375rem; font-weight: 600; text-decoration: none; cursor: pointer; transition: all 0.2s;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
          <polyline points="15 3 21 3 21 9"/>
          <line x1="10" y1="14" x2="21" y2="3"/>
        </svg>
        View Public Profile
      </a>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button class="tab-btn active" onclick="switchTab('overview')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7"/>
        <rect x="14" y="3" width="7" height="7"/>
        <rect x="14" y="14" width="7" height="7"/>
        <rect x="3" y="14" width="7" height="7"/>
      </svg>
      Overview
    </button>
    <button class="tab-btn" onclick="switchTab('profile')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
      Church Profile
    </button>
    <button class="tab-btn" onclick="switchTab('services')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <polyline points="12 6 12 12 16 14"/>
      </svg>
      Services ({{ services.count }})
    </button>
    <button class="tab-btn" onclick="switchTab('posts')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
      </svg>
      Posts ({{ posts.count }})
    </button>
  </div>

  <!-- Tab Content -->
  
  <!-- Overview Tab -->
  <div class="tab-content active" id="tab-overview">
    <!-- Statistics -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ followers_count }}</div>
          <div class="stat-label">Followers</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ services.count }}</div>
          <div class="stat-label">Services</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ posts.count }}</div>
          <div class="stat-label">Posts</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <polyline points="17 11 19 13 23 9"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ church.member_count|default:"0" }}</div>
          <div class="stat-label">Members</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Church Profile Tab -->
  <div class="tab-content" id="tab-profile">
    {% include 'core/partials/church_profile_admin.html' %}
  </div>

  <!-- Services Tab -->
  <div class="tab-content" id="tab-services">
    <div style="background: white; border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); border: 1px solid rgba(139, 69, 19, 0.1);">
      <h2 style="font-size: 1.5rem; font-weight: 700; color: #654321; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.75rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(139, 69, 19, 0.15);">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px; color: #8B4513;">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        Bookable Services ({{ services.count }})
      </h2>
    
    {% if services %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
      {% for service in services %}
      <div style="background: rgba(255, 255, 255, 0.8); border: 1px solid rgba(139, 69, 19, 0.15); border-radius: 12px; overflow: hidden; transition: all 0.3s ease;">
        <div style="position: relative; width: 100%; height: 180px; background: linear-gradient(135deg, #F8F4E6 0%, #F4E6D0 100%); overflow: hidden;">
          {% with images=service.get_images %}
            {% if images %}
            <img src="{{ images.0.image.url }}" alt="{{ service.name }}" style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 700; color: rgba(139, 69, 19, 0.6); background: linear-gradient(135deg, rgba(139, 69, 19, 0.1) 0%, rgba(160, 82, 45, 0.1) 100%);">{{ service.name.0|upper }}</div>
            {% endif %}
          {% endwith %}
        </div>
        <div style="padding: 1.5rem;">
          <h4 style="font-size: 1.25rem; font-weight: 700; color: #2D1810; margin: 0 0 0.75rem 0; line-height: 1.3;">{{ service.name }}</h4>
          <p style="font-size: 0.9375rem; color: #6b7280; line-height: 1.6; margin: 0 0 1.25rem 0; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">{{ service.description|default:"No description provided." }}</p>
          <div style="display: flex; gap: 1.25rem; align-items: center; padding-top: 1.25rem; border-top: 1px solid rgba(139, 69, 19, 0.1);">
            <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #8B4513; font-weight: 600;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px; color: #A0522D;">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <span>{{ service.duration_display }}</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #8B4513; font-weight: 600;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px; color: #A0522D;">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
              <span>{{ service.price_display }}</span>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 4rem 2rem; color: #9ca3af;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 64px; height: 64px; margin: 0 auto 1.5rem; color: #d1d5db;">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <p style="margin: 0; font-size: 1.125rem; font-weight: 500;">No services available yet.</p>
    </div>
    {% endif %}
    </div>
  </div>

  <!-- Posts Tab -->
  <div class="tab-content" id="tab-posts">
    <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); border: 1px solid rgba(139, 69, 19, 0.1);">
      <h2 style="font-size: 1.5rem; font-weight: 700; color: #654321; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.75rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(139, 69, 19, 0.15);">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px; color: #8B4513;">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
        </svg>
        Recent Posts ({{ posts.count }})
      </h2>
      
      <div style="text-align: center; padding: 4rem 2rem; color: #9ca3af;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 64px; height: 64px; margin: 0 auto 1.5rem; color: #d1d5db;">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <p style="margin: 0; font-size: 1.125rem; font-weight: 500;">No posts available yet.</p>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
function switchTab(tabId) {
  // Remove active class from all tabs and contents
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  // Add active class to clicked tab and corresponding content
  event.target.closest('.tab-btn').classList.add('active');
  document.getElementById('tab-' + tabId).classList.add('active');
}
</script>
{% endblock %}
