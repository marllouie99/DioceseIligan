{% extends 'layouts/app_base.html' %}
{% load static %}

{% block title %}{{ page_title }} - ChurchIligan{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/themes/blue-sky-theme.css' %}?v={{ STATIC_VERSION}}">
<link rel="stylesheet" href="{% static 'css/pages/services.css' %}?v={{ STATIC_VERSION }}">
{% endblock %}

{% block sidebar %}
  {% include 'partials/sidebar.html' %}
{% endblock %}

{% block topbar %}
  {% include 'partials/topbar.html' %}
{% endblock %}

{% block content %}
<div class="create-service-page blue-sky">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <a href="{% url 'core:manage_church' %}?tab=services" class="back-button" title="Back to Services">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </a>
      <div class="header-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21,15 16,10 5,21"/>
        </svg>
      </div>
      <div class="header-text">
        <h1 class="page-title">Manage Service Images</h1>
        <p class="page-subtitle">{{ service.name }}</p>
      </div>
    </div>
  </div>

  <!-- Form Container -->
  <div class="form-container">
    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="message message-{{ message.tags }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Add Image Form -->
    <div class="form-sections">
      <div class="form-section">
        <h2 class="section-title">Add New Image</h2>
        <form method="post" enctype="multipart/form-data" id="image-form">
          {% csrf_token %}
          <div class="form-grid">
            <div class="form-group form-group-full">
              <label for="{{ form.image.id_for_label }}" class="form-label">Image *</label>
              {{ form.image }}
              <small class="form-help">Upload an image for this service</small>
              {% if form.image.errors %}
                <div class="form-error">{{ form.image.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="form-group form-group-full">
              <label class="form-checkbox-label">
                {{ form.is_primary }}
                <span class="checkbox-text">Set as primary image</span>
              </label>
              <small class="form-help">Primary image will be displayed on service cards</small>
              {% if form.is_primary.errors %}
                <div class="form-error">{{ form.is_primary.errors.0 }}</div>
              {% endif %}
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              <span class="btn-text">Add Image</span>
              <span class="btn-spinner" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="animate-spin">
                  <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
              </span>
            </button>
          </div>
        </form>
      </div>

      <!-- Image Gallery Section -->
      <div class="form-section">
        <h2 class="section-title">Service Images ({{ images|length }})</h2>
        {% if images %}
          <div class="image-preview-grid">
            {% for image in images %}
              <div class="image-preview-item">
                {% if image.is_primary %}
                  <div class="primary-badge">Primary</div>
                {% endif %}
                <img src="{{ image.image.url }}" alt="{{ image.caption|default:service.name }}" class="preview-image" loading="lazy" decoding="async">
                <div class="preview-overlay">
                  <div class="image-actions">
                    <a href="{{ image.image.url }}" target="_blank" class="preview-view-btn" title="View full size">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                      </svg>
                    </a>
                    <a href="{% url 'core:delete_service_image' image.id %}" class="preview-delete-btn" title="Delete image">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 64px; height: 64px; color: #8B6F47; margin-bottom: 16px;">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21,15 16,10 5,21"/>
            </svg>
            <h3 style="color: #2D1810; margin: 0 0 8px 0;">No Images Yet</h3>
            <p style="color: #6B4226; margin: 0;">Add images to showcase this service</p>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="form-actions">
      <a href="{% url 'core:manage_church' %}?tab=services" class="btn btn-secondary">Back to Services</a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('image-form');
  if (form) {
    const submitBtn = form.querySelector('button[type="submit"]');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnSpinner = submitBtn.querySelector('.btn-spinner');
    
    // Handle form submission
    form.addEventListener('submit', function(e) {
      // Show loading state
      submitBtn.disabled = true;
      btnText.textContent = 'Adding Image...';
      btnSpinner.style.display = 'inline-block';
      submitBtn.style.opacity = '0.8';
    });
  }
});
</script>
{% endblock %}
