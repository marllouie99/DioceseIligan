{% comment %}
Partial for appointments list in Manage Church → Appointments tab.
Requires: bookings (iterable of Booking), each with b.service, b.user, and optional b.is_conflict
{% endcomment %}

{% if bookings %}
  <div class="appointments-table-wrapper">
    <table class="appointments-table">
      <thead>
        <tr>
          <th>Service</th>
          <th>User</th>
          <th>Contact</th>
          <th>Date</th>
          <th>Time</th>
          <th>Duration</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for b in bookings %}
          <tr class="appointment-row status-{{ b.status }} {% if b.is_conflict %}conflict-row{% endif %}" 
              style="{% if b.status == 'approved' %}background: rgba(34, 197, 94, 0.1) !important; border-left: 4px solid #22c55e !important;{% elif b.status == 'canceled' or b.status == 'cancelled' or b.status == 'declined' %}background: rgba(156, 163, 175, 0.15) !important; border-left: 4px solid #9ca3af !important; opacity: 0.7 !important;{% elif b.status == 'requested' %}background: rgba(234, 179, 8, 0.1) !important; border-left: 4px solid #eab308 !important;{% elif b.status == 'reviewed' %}background: rgba(59, 130, 246, 0.1) !important; border-left: 4px solid #3b82f6 !important;{% elif b.status == 'completed' %}background: rgba(139, 69, 19, 0.1) !important; border-left: 4px solid #8b4513 !important;{% endif %}">
            <td class="service-cell">
              <span class="service-name">{{ b.service.name }}</span>
            </td>
            <td class="user-cell">
              <div class="user-info">
                <div class="user-avatar">
                  {% if b.user.profile and b.user.profile.profile_image %}
                    <img src="{{ b.user.profile.profile_image.url }}" alt="{{ b.user.get_full_name|default:b.user.username }}" loading="lazy">
                  {% else %}
                    <span class="avatar-initial">{{ b.user.get_full_name|default:b.user.username|slice:":1"|upper }}</span>
                  {% endif %}
                </div>
                <span class="user-name">{{ b.user.get_full_name|default:b.user.username }}</span>
              </div>
            </td>
            <td class="contact-cell">
              {% if b.user.profile.phone %}
                {{ b.user.profile.phone }}
              {% elif b.user.email and not b.user.email|stringformat:"s"|slice:"-15:" == "@temporary.local" %}
                {{ b.user.email }}
              {% else %}
                No contact info
              {% endif %}
            </td>
            <td class="date-cell">{{ b.date|date:'Y-m-d' }}</td>
            <td class="time-cell">
              {% if b.start_time %}{{ b.start_time|time:'g:i A' }}{% else %}--{% endif %}
            </td>
            <td class="duration-cell">
              {% if b.service.duration %}{{ b.service.duration }} min{% else %}--{% endif %}
            </td>
            <td class="amount-cell">
              {% if b.service.price %}
                {% if b.service.price > 0 %}
                  ₱{{ b.service.price }}
                {% else %}
                  Donation
                {% endif %}
              {% else %}
                Free
              {% endif %}
            </td>
            <td class="status-cell">
              <span class="status-badge status-{{ b.status }}">{{ b.get_status_display }}</span>
              {% if b.is_conflict %}
                <span class="status-badge status-conflict" title="{% if b.conflict_type == 'date' %}Multiple bookings on same date{% else %}User has multiple bookings on this date{% endif %}">
                  CONFLICT
                </span>
              {% endif %}
            </td>
            <td class="actions-cell">
              <div class="dropdown-wrapper">
                <button class="action-btn" onclick="toggleDropdown(this, event)">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="1"/>
                    <circle cx="12" cy="5" r="1"/>
                    <circle cx="12" cy="19" r="1"/>
                  </svg>
                </button>
                <div class="action-dropdown">
                  <a href="{% url 'core:manage_booking' b.id %}" class="dropdown-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                    View Details
                  </a>
                  <a href="{% url 'core:manage_booking' b.id %}" class="dropdown-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Edit Booking
                  </a>
                  <a href="#" class="dropdown-item dropdown-item-danger" onclick="return confirm('Are you sure you want to cancel this booking?')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="15" y1="9" x2="9" y2="15"/>
                      <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                    Cancel Booking
                  </a>
                </div>
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
      <line x1="16" y1="2" x2="16" y2="6"/>
      <line x1="8" y1="2" x2="8" y2="6"/>
      <line x1="3" y1="10" x2="21" y2="10"/>
    </svg>
    <h3>No Appointments</h3>
    <p>When people request appointments, they will show up here.</p>
  </div>
{% endif %}
