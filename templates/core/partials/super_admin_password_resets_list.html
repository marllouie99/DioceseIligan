{% if password_resets %}
  <div class="activity-table">
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>Code</th>
          <th>Status</th>
          <th>Attempts</th>
          <th>IP Address</th>
          <th>Device Info</th>
          <th>Created</th>
          <th>Expires</th>
        </tr>
      </thead>
      <tbody>
        {% for pr in password_resets %}
          <tr>
            <td><strong>{{ pr.email }}</strong></td>
            <td><code>{{ pr.code }}</code></td>
            <td>
              {% if pr.is_used %}
                <span class="verification-status verification-used">Used</span>
              {% elif pr.expires_at < now %}
                <span class="verification-status verification-expired">Expired</span>
              {% else %}
                <span class="verification-status verification-unused">Pending</span>
              {% endif %}
            </td>
            <td><span class="{% if pr.attempts >= 5 %}text-danger{% elif pr.attempts >= 3 %}text-warning{% endif %}">{{ pr.attempts }}/5</span></td>
            <td>{% if pr.ip_address %}<code>{{ pr.ip_address }}</code>{% else %}<span class="text-muted">-</span>{% endif %}</td>
            <td>
              <div class="device-info">
                {% if pr.device_info %}
                  <div title="{{ pr.user_agent }}">{{ pr.device_info }}</div>
                {% elif pr.user_agent %}
                  <div title="{{ pr.user_agent }}">{{ pr.user_agent|truncatechars:30 }}</div>
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </div>
            </td>
            <td><div>{{ pr.created_at|date:'M j, Y' }}</div><small class="text-muted">{{ pr.created_at|time:'g:i A' }}</small></td>
            <td><div>{{ pr.expires_at|date:'M j, Y' }}</div><small class="text-muted">{{ pr.expires_at|time:'g:i A' }}</small></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if password_resets.has_other_pages %}
    <div class="pagination">
      {% if password_resets.has_previous %}
        <a href="?{{ request.GET.urlencode }}&password_resets_page={{ password_resets.previous_page_number }}">&laquo; Previous</a>
      {% endif %}
      <span class="current">Page {{ password_resets.number }} of {{ password_resets.paginator.num_pages }}</span>
      {% if password_resets.has_next %}
        <a href="?{{ request.GET.urlencode }}&password_resets_page={{ password_resets.next_page_number }}">Next &raquo;</a>
      {% endif %}
    </div>
  {% endif %}
{% else %}
  <div class="empty-state">
    <p>No password reset codes found for the selected filters.</p>
  </div>
{% endif %}
