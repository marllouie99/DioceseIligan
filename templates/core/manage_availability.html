{% extends 'layouts/app_base.html' %}
{% load static %}

{% block title %}Manage Availability - ChurchConnect{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/themes/warm-sacred-earth-theme.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'css/manage_church.css' %}">
<link rel="stylesheet" href="{% static 'css/pages/availability.css' %}?v={{ STATIC_VERSION }}">
{% endblock %}

{% block sidebar %}
  {% include 'partials/sidebar.html' %}
{% endblock %}

{% block topbar %}
  {% include 'partials/topbar.html' %}
{% endblock %}

{% block content %}
<div class="manage-availability-page warm-sacred-earth">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12,6 12,12 16,14"/>
        </svg>
      </div>
      <div class="header-text">
        <h1 class="page-title">Manage Availability</h1>
        <p class="page-subtitle">Set closed dates and special hours for {{ church.name }}</p>
      </div>
    </div>
  </div>

  <!-- Availability Management -->
  <div class="availability-management">
    <div class="availability-layout">
      <!-- Closed Dates List -->
      <div class="closed-dates-section">
        <h3>Closed Dates & Special Hours</h3>
        {% if availability_entries %}
          <div class="closed-dates-list">
            {% for availability in availability_entries %}
              <div class="closed-date-item {% if availability.is_closed %}closed{% else %}special-hours{% endif %}">
                <div class="date-info">
                  <div class="date">{{ availability.date|date:"M d, Y" }}</div>
                  <div class="date-type">
                    {% if availability.is_closed %}
                      <span class="status-closed">Closed</span>
                    {% else %}
                      <span class="status-special">{{ availability.start_time|time:"g:i A" }} - {{ availability.end_time|time:"g:i A" }}</span>
                    {% endif %}
                  </div>
                  {% if availability.reason %}
                    <div class="date-reason">{{ availability.reason }}</div>
                  {% endif %}
                </div>
                <div class="date-actions">
                  <a href="{% url 'core:edit_availability' availability.id %}" class="btn-icon" title="Edit">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                  </a>
                  <a href="{% url 'core:delete_availability' availability.id %}" class="btn-icon btn-danger" title="Delete">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z"/>
                    </svg>
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12,6 12,12 16,14"/>
            </svg>
            <h3>No Closed Dates Set</h3>
            <p>Your church is available for all bookable services. Click on a date in the calendar to add closed dates or special hours.</p>
          </div>
        {% endif %}
      </div>
      
      <!-- Calendar Widget -->
      <div class="availability-calendar">
        <h3>Calendar View</h3>
        <div class="calendar-container">
          <div class="calendar-header">
            <button class="calendar-nav" id="prev-month">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15,18 9,12 15,6"/>
              </svg>
            </button>
            <h4 class="calendar-month" id="current-month"></h4>
            <button class="calendar-nav" id="next-month">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,18 15,12 9,6"/>
              </svg>
            </button>
          </div>
          <div class="calendar-grid" id="calendar-grid">
            <!-- Calendar will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h3>Quick Actions</h3>
    <div class="actions-grid">
      <a href="{% url 'core:manage_services' %}" class="action-card">
        <div class="action-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
        <div class="action-content">
          <h4>Manage Services</h4>
          <p>Create and manage bookable services</p>
        </div>
      </a>
      
      <a href="{% url 'core:manage_church' %}" class="action-card">
        <div class="action-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </div>
        <div class="action-content">
          <h4>Church Settings</h4>
          <p>Manage your church information and settings</p>
        </div>
      </a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Make availability data available to JavaScript
  window.availabilityData = {
    {% for availability in availability_entries %}
      '{{ availability.date|date:"Y-m-d" }}': {
        is_closed: {{ availability.is_closed|yesno:"true,false" }},
        reason: '{{ availability.reason|escapejs }}',
        start_time: '{{ availability.start_time|time:"H:i" }}',
        end_time: '{{ availability.end_time|time:"H:i" }}'
      },
    {% endfor %}
  };
  
  // Make Django URLs available to JavaScript
  window.createAvailabilityUrl = "{% url 'core:create_availability' %}";
</script>
{% load static %}
<!-- Load availability modules -->
<script src="{% static 'js/modules/availability-calendar.js' %}?v={{ STATIC_VERSION }}"></script>
<script src="{% static 'js/modules/availability-data.js' %}?v={{ STATIC_VERSION }}"></script>
<script src="{% static 'js/modules/availability-events.js' %}?v={{ STATIC_VERSION }}"></script>
<!-- Load main manage availability application -->
<script src="{% static 'js/manage_availability_new.js' %}?v={{ STATIC_VERSION }}"></script>
{% endblock %}
