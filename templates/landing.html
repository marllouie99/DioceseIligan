{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Welcome to ChurchConnect</title>
  <link rel="stylesheet" href="{% static 'css/variables/warm-sacred-earth-vars.css' %}?v={{ STATIC_VERSION }}">
  <link rel="stylesheet" href="{% static 'css/pages/landing.css' %}?v={{ STATIC_VERSION }}">
</head>
<body>
  <div class="landing-wrap">
    <div class="landing-container">
      <!-- Left Side - Hero Carousel -->
      <div class="hero-content">
        <div class="hero-carousel">
          <!-- Slide 1: Welcome & Mission -->
          <div class="hero-slide active" data-slide="0">
            <h1>Connect Your Parish Community</h1>
            <p class="subtitle">Building stronger spiritual connections through technology and faith</p>
            
            <div class="mission-statement">
              <h3>🌿 Our Mission</h3>
              <p>We believe every church deserves powerful tools to build meaningful relationships, manage services seamlessly, and grow their spiritual community. ChurchConnect brings faith communities together in the digital age.</p>
            </div>
          </div>

          <!-- Slide 2: Community Posts -->
          <div class="hero-slide" data-slide="1">
            <h2>Community Highlights</h2>
            <p class="subtitle">See what's happening in our church communities</p>
            
            <div class="testimonials">
              {% if random_posts %}
                {% for post in random_posts|slice:":2" %}
                <div class="testimonial">
                  <p class="testimonial-quote">"{{ post.content|truncatewords:30 }}"</p>
                  <p class="testimonial-author">— {{ post.church.name }}</p>
                  <p class="testimonial-date" style="font-size: 0.75rem; color: #94a3b8; margin-top: 0.25rem;">{{ post.created_at|timesince }} ago</p>
                </div>
                {% endfor %}
              {% else %}
                <div class="testimonial">
                  <p class="testimonial-quote">"Join our growing community of churches connecting and sharing their faith journey."</p>
                  <p class="testimonial-author">— ChurchConnect Community</p>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Slide 3: Stats & Impact -->
          <div class="hero-slide" data-slide="2">
            <h2>Growing Communities</h2>
            <p class="subtitle">Real-time statistics from our active community</p>
            
            <div class="stats-bar">
              <div class="stat-item">
                <span class="stat-number">{{ total_churches|default:"0" }}</span>
                <p class="stat-label">Active Churches</p>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ total_users|default:"0" }}</span>
                <p class="stat-label">Total Users</p>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ total_posts|default:"0" }}</span>
                <p class="stat-label">Community Posts</p>
              </div>
            </div>

            <div class="cta-section">
              <p class="cta-text">Ready to transform your church community?</p>
              <div class="cta-arrow">→</div>
            </div>
          </div>
        </div>

        <!-- Carousel Controls -->
        <div class="carousel-controls">
          <div class="carousel-dots">
            <button class="dot active" data-slide="0" aria-label="Slide 1"></button>
            <button class="dot" data-slide="1" aria-label="Slide 2"></button>
            <button class="dot" data-slide="2" aria-label="Slide 3"></button>
          </div>
          <div class="carousel-nav">
            <button class="nav-btn prev" id="prevSlide" aria-label="Previous slide">‹</button>
            <button class="nav-btn next" id="nextSlide" aria-label="Next slide">›</button>
          </div>
        </div>
      </div>
      
      <!-- Right Side - Glassmorphism Form -->
      <div class="card">
      <h1 class="title" id="heading-title" style="margin-top: 20px;">Welcome to</h1>
      <div class="logo-stack">
        <img src="{% static 'images/diocese_of_Iligan.png' %}" alt="Diocese of Iligan" style="width: 180px; height: auto; margin: 0 auto; display: block;">
      </div>

      <p class="subtitle">Connect with your church community</p>

      <div class="segmented" id="segmented">
        <button id="tab-signin" class="{% if active_tab != 'signup' %}active{% endif %}">Sign In</button>
        <button id="tab-signup" class="{% if active_tab == 'signup' %}active{% endif %}">Sign Up</button>
      </div>

      {% if messages %}
      <div>
        {% for message in messages %}
          <p style="color:#b91c1c; margin: 8px 4px;">{{ message }}</p>
        {% endfor %}
      </div>
      {% endif %}

      <div class="form">
        <!-- Progressive Sign In Form -->
        <form id="signin-form" method="post" action="{% url 'landing' %}" style="{% if active_tab == 'signup' %}display:none{% endif %}">
          {% csrf_token %}
          <input type="hidden" name="action" value="signin" />

          <!-- Step 1: Email Entry -->
          <div id="email-step" class="login-step">
            <div class="field">
              <div class="label">Email</div>
              <div class="input">
                <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6h16v12H4z" stroke="#94a3b8" stroke-width="1.5"/><path d="M4 7l8 6 8-6" stroke="#94a3b8" stroke-width="1.5"/></svg>
                <input type="email" name="email_or_username" id="signin-email" placeholder="Your email address" required />
              </div>
              {% if login_form.email_or_username.errors %}
                <small style="color:#b91c1c">{{ login_form.email_or_username.errors.0 }}</small>
              {% endif %}
            </div>

            <div class="actions">
              <button class="btn-primary" type="button" id="email-continue-btn">Continue</button>
            </div>

            <!-- OR Divider -->
            <div class="divider">
              <span>OR</span>
            </div>

            <!-- Google OAuth Button -->
            <div class="actions">
              {% if google_oauth_configured %}
                <a href="{% url 'google_login' %}" class="btn-google">
                  <svg class="google-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                  </svg>
                  Continue with Google
                </a>
              {% else %}
                <div class="btn-google-disabled">
                  <svg class="google-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path fill="#9CA3AF" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#9CA3AF" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#9CA3AF" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#9CA3AF" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                  </svg>
                  Google OAuth (Setup Required)
                </div>
              {% endif %}
            </div>

            <!-- Email Sign-in Code Option -->
            <div class="actions">
              <a href="{% url 'login_with_code' %}" class="btn-secondary">
                <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M4 8l8 5 8-5" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                Email sign-in code
              </a>
            </div>
          </div>

          <!-- Step 2: Login Options (initially hidden) -->
          <div id="login-options-step" class="login-step" style="display: none;">
            <!-- Show entered email -->
            <div class="email-display">
              <div class="label">Email</div>
              <div class="email-value" id="displayed-email"></div>
            </div>

            <!-- Password Option -->
            <div class="field">
              <div class="label">Password <a href="{% url 'forgot_password' %}" class="forgot-link">Forgot your password?</a></div>
              <div class="input">
                <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 10V8a6 6 0 1112 0v2" stroke="#94a3b8" stroke-width="1.5"/><rect x="4" y="10" width="16" height="10" rx="2" stroke="#94a3b8" stroke-width="1.5"/></svg>
                <input type="password" name="password" id="signin-password" placeholder="Your password" />
                <button class="password-toggle" type="button" aria-label="toggle password">👁</button>
              </div>
              {% if login_form.password.errors %}
                <small style="color:#b91c1c">{{ login_form.password.errors.0 }}</small>
              {% endif %}
            </div>

            <div class="actions">
              <button class="btn-primary" type="submit">Sign In</button>
            </div>


            <!-- Go Back Option -->
            <div class="back-link">
              <button type="button" id="go-back-btn" class="go-back">← Go back</button>
            </div>
          </div>

          <!-- Sign Up Link (shown in both steps) -->
          <div class="links signup-link">
            <p class="muted">Don't have an account? <a href="#" id="link-signup">Sign up</a></p>
          </div>
        </form>

        <!-- Sign Up Form -->
        <form id="signup-form" method="post" action="{% url 'landing' %}" style="{% if active_tab == 'signup' %}display:block{% else %}display:none{% endif %}">
          {% csrf_token %}
          <input type="hidden" name="action" value="signup" />

          <div class="field">
            <div class="label">Full name</div>
            <div class="input">
              <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="4" stroke="#94a3b8" stroke-width="1.5"/><path d="M4 20c1.8-3.2 5-5 8-5s6.2 1.8 8 5" stroke="#94a3b8" stroke-width="1.5"/></svg>
              {{ signup_form.full_name }}
            </div>
            {% if signup_form.full_name.errors %}
              <small style="color:#b91c1c">{{ signup_form.full_name.errors.0 }}</small>
            {% endif %}
          </div>

          <div class="field">
            <div class="label">Email</div>
            <div class="input">
              <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6h16v12H4z" stroke="#94a3b8" stroke-width="1.5"/><path d="M4 7l8 6 8-6" stroke="#94a3b8" stroke-width="1.5"/></svg>
              {{ signup_form.email }}
            </div>
            {% if signup_form.email.errors %}
              <small style="color:#b91c1c">{{ signup_form.email.errors.0 }}</small>
            {% endif %}
          </div>

          <div class="field">
            <div class="label">Password</div>
            <div class="input">
              <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 10V8a6 6 0 1112 0v2" stroke="#94a3b8" stroke-width="1.5"/><rect x="4" y="10" width="16" height="10" rx="2" stroke="#94a3b8" stroke-width="1.5"/></svg>
              {{ signup_form.password }}
              <button class="password-toggle" type="button" aria-label="toggle password">👁</button>
            </div>
            {% if signup_form.password.errors %}
              <small style="color:#b91c1c">{{ signup_form.password.errors.0 }}</small>
            {% endif %}
          </div>

          <div class="field">
            <div class="label">Confirm password</div>
            <div class="input">
              <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 10V8a6 6 0 1112 0v2" stroke="#94a3b8" stroke-width="1.5"/><rect x="4" y="10" width="16" height="10" rx="2" stroke="#94a3b8" stroke-width="1.5"/></svg>
              {{ signup_form.confirm_password }}
            </div>
            {% if signup_form.confirm_password.errors %}
              <small style="color:#b91c1c">{{ signup_form.confirm_password.errors.0 }}</small>
            {% endif %}
          </div>

          <div class="actions">
            <button class="btn-primary" type="submit">Create account</button>
          </div>

          <div class="links">
            <p class="muted">Already have an account? <a href="#" id="link-signin">Sign In</a></p>
          </div>
        </form>
      </div>
      </div>
    </div>
  </div>

  <!-- Featured Churches Section -->
  <div class="churches-section">
      <div class="churches-container">
        <div class="churches-header">
          <h2 class="churches-title">Discover Churches</h2>
          <p class="churches-subtitle">Connect with faith communities in your area</p>
        </div>

        {% if featured_churches %}
        <div class="churches-grid">
          {% for church in featured_churches %}
          <div class="church-card">
            <div class="church-card-image">
              {% if church.cover_image %}
                <img src="{{ church.cover_image.url }}" alt="{{ church.name }}" loading="lazy">
              {% else %}
                <div class="church-placeholder">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L3 9v11a2 2 0 002 2h14a2 2 0 002-2V9l-9-7z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12h6v10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              {% endif %}
              {% if church.is_verified %}
              <div class="verified-badge" title="Verified Church">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              {% endif %}
            </div>
            <div class="church-card-content">
              <h3 class="church-name">{{ church.name }}</h3>
              <p class="church-location">
                <svg class="location-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="12" cy="9" r="2.5" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                {{ church.city|default:"Location not set" }}
              </p>
              {% if church.description %}
              <p class="church-description">{{ church.description|truncatewords:15 }}</p>
              {% endif %}
              <div class="church-stats">
                <span class="church-stat">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="1.5"/>
                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                  {{ church.follower_count }} follower{{ church.follower_count|pluralize }}
                </span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="churches-footer">
          <a href="{% url 'core:discover' %}" class="btn-explore">
            Explore More Parishes
            <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
        {% else %}
        <div class="churches-empty">
          <p>No churches available at the moment. Check back soon!</p>
        </div>
        {% endif %}
      </div>
  </div>

  <!-- Footer -->
  <footer class="landing-footer">
    <div class="footer-container">
      <div class="footer-content">
        <!-- About Section -->
        <div class="footer-section">
          <h3 class="footer-title">Diocese of Iligan</h3>
          <p class="footer-description">Building stronger spiritual connections through technology and faith. Connect with your parish community and grow together.</p>
          <div class="footer-logo">
            <img src="{% static 'images/diocese_of_Iligan.png' %}" alt="Diocese of Iligan" class="footer-logo-img">
          </div>
        </div>

        <!-- Quick Links -->
        <div class="footer-section">
          <h4 class="footer-heading">Quick Links</h4>
          <ul class="footer-links">
            <li><a href="{% url 'core:discover' %}">Discover Churches</a></li>
            <li><a href="{% url 'landing' %}">Sign In</a></li>
            <li><a href="{% url 'landing' %}?tab=signup">Sign Up</a></li>
            <li><a href="{% url 'core:create_church' %}">Create Church</a></li>
          </ul>
        </div>

        <!-- Resources -->
        <div class="footer-section">
          <h4 class="footer-heading">Resources</h4>
          <ul class="footer-links">
            <li><a href="#">About Us</a></li>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>

        <!-- Contact -->
        <div class="footer-section">
          <h4 class="footer-heading">Connect With Us</h4>
          <ul class="footer-links">
            <li><a href="mailto:support@churchconnect.com">support@churchconnect.com</a></li>
            <li><a href="#">Community Forum</a></li>
            <li><a href="#">Facebook</a></li>
            <li><a href="#">Twitter</a></li>
          </ul>
        </div>
      </div>

      <!-- Footer Bottom -->
      <div class="footer-bottom">
        <p class="footer-copyright">&copy; {% now "Y" %} Diocese of Iligan. All rights reserved.</p>
        <p class="footer-tagline">Empowering faith communities in the digital age</p>
      </div>
    </div>
  </footer>

  <script defer src="{% static 'js/landing.js' %}"></script>
  <script defer src="{% static 'js/hero-carousel.js' %}"></script>
  <script defer src="{% static 'js/utils/clock-sync.js' %}"></script>
</body>
</html>
